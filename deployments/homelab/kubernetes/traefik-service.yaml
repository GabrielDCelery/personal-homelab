# Service named "reverse-proxy" - this is what the Cloudflare tunnel expects
apiVersion: v1
kind: Service
metadata:
  # - What it is: Creates a stable network endpoint
  # - name: DNS name will be reverse-proxy.homelab.svc.cluster.local
  # - Behavior: Provides a single IP address even if pods restart (ClusterIP doesn't change)
  name: reverse-proxy
  namespace: homelab
spec:
  # - What it does: Creates an internal-only IP address
  # - Behavior: Only accessible from within the cluster (not from outside)
  # - Alternatives:
  #   - NodePort: Exposes on each node's IP
  #   - LoadBalancer: Gets external IP (cloud providers)
  # - Your setup: Perfect because Cloudflare tunnel connects from inside the cluster
  type: ClusterIP
  selector:
    # - Critical: This is how the Service finds pods to route traffic to
    # - Behavior: Looks for any pod with label app: traefik
    # - Load balancing: If multiple pods exist (replicas > 1), distributes traffic among them
    # - Dynamic: If pods are added/removed, Service automatically updates
    app: traefik
  ports:
    # - name: Labels this port mapping as "web" (just documentation)
    # - port: 80: The Service listens on port 80
    # - targetPort: 80: Forwards traffic to port 80 on the pod
    # - Behavior: http://reverse-proxy:80 → forwards to container port 80
    # - Flow: cloudflared → Service (port 80) → Pod (targetPort 80)
    - name: web
      port: 80
      targetPort: 80
    # - port: 8080: The Service listens on port 8080
    # - targetPort: 8080: Forwards to container port 8080 (dashboard)
    # - Behavior: http://reverse-proxy:8080 → forwards to Traefik dashboard
    # - Your setup: Cloudflare tunnel now points here to show the dashboard
    - name: dashboard
      port: 8080
      targetPort: 8080
